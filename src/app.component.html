<ion-tabs>
  <div class="ion-page">
    <ion-header>
      <ion-toolbar color="dark">
        @if (activeView() === 'hoy') {
          <div class="text-center py-2">
              <p class="text-xs text-gray-400">{{ currentTime() | date:'EEEE, d MMMM' }}</p>
              <h1 class="text-2xl font-bold tracking-wider -mt-1">{{ currentTime() | date:'HH:mm:ss' }}</h1>
          </div>
        } @else {
          <ion-title class="ion-text-capitalize">{{ activeView() }}</ion-title>
        }
      </ion-toolbar>
    </ion-header>

    <ion-content [fullscreen]="true">
      <div [class.hidden]="activeView() !== 'hoy'" class="ion-padding">
        <!-- Clock-in Card -->
        <ion-card class="mx-auto max-w-sm">
          <ion-card-content class="flex flex-col items-center space-y-6 pt-8">
            <div [class]="'w-24 h-24 rounded-full flex items-center justify-center ' + (clockedIn() ? 'bg-red-500/20' : 'bg-green-500/20')">
              <div [class]="'w-20 h-20 rounded-full flex items-center justify-center ' + (clockedIn() ? 'bg-red-500/30' : 'bg-green-500/30')">
                <button (click)="handleClockInOut()" [class]="'w-16 h-16 rounded-full text-white text-lg font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg ' + (clockedIn() ? 'bg-red-600 hover:bg-red-500' : 'bg-green-600 hover:bg-green-500')">
                  {{ clockedIn() ? 'Salir' : 'Fichar' }}
                </button>
              </div>
            </div>
            <div class="text-center">
              <p class="text-lg font-medium text-gray-300">
                {{ clockedIn() ? 'Jornada en curso' : 'Jornada no iniciada' }}
              </p>
              <p class="text-3xl font-bold text-cyan-400 mt-2">{{ formattedWorkedTime() }}</p>
              <p class="text-sm text-gray-500">Horas trabajadas hoy</p>
            </div>
          </ion-card-content>
        </ion-card>

        <!-- Time Entries List -->
        <ion-card class="mx-auto max-w-sm">
          <ion-card-header>
            <ion-card-title class="ion-text-center">Fichajes de Hoy</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            @if (timeEntries().length === 0) {
              <p class="text-center text-gray-500 py-4">Aún no hay fichajes.</p>
            } @else {
              <ion-list [inset]="true" class="-mx-4">
                @for (entry of timeEntries(); track entry.time) {
                  <ion-item>
                    @if (entry.type === 'in') {
                      <ion-icon name="arrow-down-circle-outline" slot="start" color="success"></ion-icon>
                      <ion-label>Entrada</ion-label>
                    } @else {
                      <ion-icon name="arrow-up-circle-outline" slot="start" color="danger"></ion-icon>
                      <ion-label>Salida</ion-label>
                    }
                    <ion-note slot="end" color="medium">{{ formatTime(entry.time) }}</ion-note>
                  </ion-item>
                }
              </ion-list>
            }
          </ion-card-content>
        </ion-card>
      </div>
      
      <div [class.hidden]="activeView() !== 'calendario'" class="ion-padding">
        <ion-card class="mx-auto max-w-sm"><ion-card-content><div #calendarContainer></div></ion-card-content></ion-card>
      </div>

      <div [class.hidden]="activeView() !== 'resumen'" class="ion-padding">
        <div class="max-w-sm mx-auto space-y-4">
          <ion-segment [value]="summaryView()" (ionChange)="changeSummaryView($event)">
            <ion-segment-button value="semanal"><ion-label>Semanal</ion-label></ion-segment-button>
            <ion-segment-button value="mensual"><ion-label>Mensual</ion-label></ion-segment-button>
          </ion-segment>

          @if (summaryView() === 'semanal') {
            <ion-card><ion-card-header><ion-card-title class="ion-text-center">Horas de la Semana</ion-card-title></ion-card-header><ion-card-content><div #chartContainer style="width: 100%; height:250px;"></div></ion-card-content></ion-card>
          } @else {
            <ion-card><ion-card-content class="h-[298px] flex items-center justify-center"><p class="text-gray-400">El resumen mensual está en construcción.</p></ion-card-content></ion-card>
          }

          <ion-card><ion-card-content><ion-list lines="none"><ion-item><ion-label class="text-gray-400">Horas esta semana</ion-label><p class="text-xl font-bold text-cyan-400">37.7h / 40h</p></ion-item></ion-list></ion-card-content></ion-card>
          <ion-card><ion-card-content><ion-list lines="none"><ion-item><ion-label class="text-gray-400">Horas este mes</ion-label><p class="text-xl font-bold">112h / 160h</p></ion-item></ion-list></ion-card-content></ion-card>
        </div>
      </div>
      
      <div [class.hidden]="activeView() !== 'perfil'" class="ion-padding">
        <div class="w-full max-w-sm mx-auto space-y-6">
          <div class="flex flex-col items-center space-y-4 pt-4">
            <ion-avatar class="w-24 h-24"><img alt="avatar" src="https://picsum.photos/200" /></ion-avatar>
            <div class="text-center">
              <h2 class="text-xl font-bold text-white">Juan Pérez</h2>
              <p class="text-sm text-gray-400">juan.perez@empresa.com</p>
            </div>
          </div>
          <ion-list [inset]="true">
            <ion-item button="true"><ion-icon name="person-circle-outline" slot="start" color="primary"></ion-icon><ion-label>Mis Datos Personales</ion-label></ion-item>
            <ion-item button="true"><ion-icon name="notifications-outline" slot="start" color="primary"></ion-icon><ion-label>Notificaciones</ion-label></ion-item>
            <ion-item button="true"><ion-icon name="settings-outline" slot="start" color="primary"></ion-icon><ion-label>Ajustes</ion-label></ion-item>
          </ion-list>
          <div class="px-4"><ion-button expand="block" color="danger" fill="outline"><ion-icon name="log-out-outline" slot="start"></ion-icon>Cerrar Sesión</ion-button></div>
        </div>
      </div>
    </ion-content>
  </div>

  <ion-tab-bar slot="bottom">
    <ion-tab-button [class.tab-selected]="activeView() === 'hoy'" (click)="changeView('hoy')">
      <ion-icon name="time-outline"></ion-icon>
      <ion-label>Hoy</ion-label>
    </ion-tab-button>
    <ion-tab-button [class.tab-selected]="activeView() === 'calendario'" (click)="changeView('calendario')">
      <ion-icon name="calendar-outline"></ion-icon>
      <ion-label>Calendario</ion-label>
    </ion-tab-button>
    <ion-tab-button [class.tab-selected]="activeView() === 'resumen'" (click)="changeView('resumen')">
      <ion-icon name="bar-chart-outline"></ion-icon>
      <ion-label>Resumen</ion-label>
    </ion-tab-button>
    <ion-tab-button [class.tab-selected]="activeView() === 'perfil'" (click)="changeView('perfil')">
      <ion-icon name="person-circle-outline"></ion-icon>
      <ion-label>Perfil</ion-label>
    </ion-tab-button>
  </ion-tab-bar>
</ion-tabs>